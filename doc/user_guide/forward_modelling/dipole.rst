.. _dipole:

Magnetic dipoles
================

We can compute the magnetic field generated by dipole sources through
the :func:`harmonica.dipole_magnetic` function.

Each dipole can be defined as a tuple containing its coordinates in the
following order: *easting*, *northing*, *upward* (in Cartesian coordinates and
in meters).

.. jupyter-execute::
   :hide-code:

   import harmonica as hm

Let's define a single dipole and compute the magnetic field it generates on
a computation point above it.

Define the dipole and its magnetic moment vector:

.. jupyter-execute::

   dipole = (20, 40, -50)
   magnetic_moment = (100, 100, 100)

Define the observation point above it:

.. jupyter-execute::

   coordinates = (20, 40, 10)

And compute the three components of the magnetic field the dipole generates by
choosing ``field="b"``:

.. jupyter-execute::

   b_e, b_n, b_u = hm.dipole_magnetic(coordinates, dipole, magnetic_moment, field="b")
   print(b_e, b_n, b_u)

We can compute just a single component with ``field`` set to ``"b_e"``,
``"b_n"`` or ``"b_u"``:

.. jupyter-execute::

   b_u = hm.dipole_magnetic(
      coordinates, dipole, magnetic_moment, field="b_u"
   )
   print(b_u)


Multiple dipoles
----------------

We can also use this function to compute the magnetic fields of multiple
dipoles on multiple observation points.

Let's define a regular grid of observation points:

.. jupyter-execute::

   import verde as vd

   region = (-100, 100, -100, 100)
   spacing = 1
   height = 0
   coordinates = vd.grid_coordinates(
      region=region, spacing=spacing, extra_coords=height
   )

And a set of dipoles with their magnetic moments:

.. jupyter-execute::

   import numpy as np

   easting = [25, 35, -30, -50]
   northing = [3, -38, 22, -30]
   upward = [-200, -100, -300, -150]
   dipoles = (easting, northing, upward)

   mag_e = [1e3, 2e3, 500, 2e3]
   mag_n = [1e3, 2e3, 500, 2e3]
   mag_u = [1e3, 2e3, 500, 2e3]
   magnetic_moments = (mag_e, mag_n, mag_u)

Now, let's compute the magnetic field components that the dipoles generate on
every observation point:

.. jupyter-execute::

   b_e, b_n, b_u = hm.dipole_magnetic(coordinates, dipoles, magnetic_moments, field="b")

We can reshape the results into variables of an dataset:

.. jupyter-execute::

   grid = vd.make_xarray_grid(
      coordinates,
      data=(b_e, b_n, b_u),
      data_names=["b_e", "b_n", "b_u"],
      extra_coords_names="extra"
   )

.. jupyter-execute::
   :hide-code:

    import pygmt

    # Needed so that displaying works on jupyter-sphinx and sphinx-gallery at
    # the same time. Using PYGMT_USE_EXTERNAL_DISPLAY="false" in the Makefile
    # for sphinx-gallery to work means that fig.show won't display anything here
    # either.
    pygmt.set_display(method="notebook")


.. jupyter-execute::

   import pygmt

   fig = pygmt.Figure()

   maxabs = vd.maxabs(grid.b_e)
   pygmt.makecpt(cmap="balance+h0", series=[-maxabs, maxabs], background=True)
   fig.grdimage(
      grid=grid.b_e,
      projection="X10c",
      cmap=True,
      frame=["WSne+tEasting component", "xa","ya"],
   )
   fig.colorbar(frame='+lnT')

   fig.shift_origin(xshift="11c")

   maxabs = vd.maxabs(grid.b_n)
   pygmt.makecpt(cmap="balance+h0", series=[-maxabs, maxabs], background=True)
   fig.grdimage(
      grid=grid.b_n,
      projection="X10c",
      cmap=True,
      frame=["wSne+tNorthing component", "xa","ya"],
   )
   fig.colorbar(frame='+lnT')

   fig.shift_origin(xshift="11c")

   maxabs = vd.maxabs(grid.b_u)
   pygmt.makecpt(cmap="balance+h0", series=[-maxabs, maxabs], background=True)
   fig.grdimage(
      grid=grid.b_u,
      projection="X10c",
      cmap=True,
      frame=["wSnE+tUpward component", "xa","ya"],
   )
   fig.colorbar(frame='+lnT')

   fig.show()

----

.. grid:: 2

    .. grid-item-card:: :jupyter-download-script:`Download Python script <dipole>`
        :text-align: center

    .. grid-item-card:: :jupyter-download-nb:`Download Jupyter notebook <dipole>`
        :text-align: center
